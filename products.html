<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VT Design Build — Products</title>

<link rel="icon" type="image/png" href="VT_logo.png" />

<style>
  :root{
    --bg:#575e52;
    --fg:#000000;
    --accent:orange;

    --fs:16px;
    --lh:1.2;

    --header-h:72px;
    --sidebar-w:180px;
    --gap:12px;
    --footer-h:100px;

    --tile:190px;           /* grid tile width/height (square) */
    --pad:8px;              /* uniform inner padding */
    --carousel-h:380px;
    --img-inset:14px;       /* featured image top/bottom inset */

    --logo-size:46px;
    --truck-size:110px;

    --cursor:16px;

    --flash-ms:800ms;
    --bounce-ms:400ms;
  }

  html, body{
    margin:0; padding:0; height:100%;
    background:var(--bg); color:var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    font-size:var(--fs); line-height:var(--lh);
    text-transform:uppercase;
    overflow:hidden;
  }

  *{ cursor:none !important; }
  a{ color:#000; text-decoration:none; }
  a:hover{ color:#fff; }
  button:focus, a:focus{ outline:none; }

  /* Custom cursor */
  #custom-cursor{
    position:fixed; top:0; left:0; width:var(--cursor); height:var(--cursor);
    pointer-events:none; z-index:9999;
    clip-path:polygon(50% 0%, 0% 100%, 100% 100%);
    background:#fff; mix-blend-mode:difference;
  }

  /* Header (truck only) */
  .header{
    position:fixed; left:0; right:0; top:0; height:var(--header-h);
    display:flex; align-items:center; justify-content:flex-end;
    padding:0 8px; box-sizing:border-box;
  }
  .truck-icon{
    width:var(--truck-size); height:var(--truck-size);
    background:url('flatbed_truck.png') no-repeat center/contain;
    transition:filter .2s ease, transform .2s ease;
    filter:none; transform-origin:center;
  }
  .truck-icon:hover{ filter:invert(1) brightness(2); }
  .truck-icon.flash{ animation:truckflash var(--flash-ms) ease; }
  .truck-icon.bounce{ animation:truckbounce var(--bounce-ms) cubic-bezier(.34,1.56,.64,1); }
  @keyframes truckflash{ 0%{filter:invert(1) brightness(2);} 100%{filter:none;} }
  @keyframes truckbounce{ 0%{transform:scale(1);} 40%{transform:scale(1.08);} 100%{transform:scale(1);} }

  /* Logo centered above sidebar */
  .logo-above-sidebar{
    position:fixed; top:6px; left:0; width:var(--sidebar-w);
    display:flex; justify-content:center; align-items:center;
    pointer-events:none;
  }
  .logo-above-sidebar img{
    width:var(--logo-size); height:var(--logo-size); object-fit:contain;
  }

  /* Sidebar */
  .sidebar{
    position:fixed; left:0; top:var(--header-h); bottom:var(--footer-h);
    width:var(--sidebar-w); background:var(--bg);
    padding:12px; box-sizing:border-box;
    display:flex; flex-direction:column; gap:.6rem;
  }
  .cat{ color:var(--fg); transition:color .2s ease; }
  .cat:hover, .cat.active{ color:#fff; } /* active stays white */

  /* Content (2 columns) */
  .content{
    position:fixed; left:var(--sidebar-w); right:0; top:var(--header-h); bottom:var(--footer-h);
    display:flex; gap:var(--gap); padding:var(--gap); box-sizing:border-box;
  }
  .left-col, .right-col{ flex:1; min-width:0; }

  /* GRID — TRUE UNIFORM SQUARES.
     Icon fills the whole square (minus padding). Title overlays at bottom (no height reservation),
     so icon always scales within the same square area. */
  .grid{
    height:100%; overflow:auto; scrollbar-width:none;
    display:grid; gap:var(--gap);
    grid-template-columns:repeat(auto-fill, minmax(var(--tile), 1fr));
    align-content:start;
  }
  .grid::-webkit-scrollbar{ display:none; }

  .tile{
    position:relative;
    aspect-ratio:1 / 1;                 /* lock each tile to a perfect square */
    background:#fff; border:1px solid #000; box-sizing:border-box;
    color:var(--fg);
    transition:background .15s ease, color .15s ease, border-color .15s ease;
    overflow:hidden;                    /* contents never change the square */
  }
  .tile:hover{ background:#000; color:#fff; }

  /* ICON fills the square minus uniform padding */
  .tile-img{
    position:absolute;
    left:var(--pad); right:var(--pad); top:var(--pad); bottom:var(--pad);
    display:grid; place-items:center;
    pointer-events:none; /* let clicks go to tile */
  }
  .tile-img img{
    width:100%; height:100%;
    object-fit:contain;                 /* SCALE PNG TO FIT WHOLE SQUARE */
    background:transparent;             /* respect PNG transparency */
    filter:none;
    transition:filter .15s ease;
  }
  .tile:hover .tile-img img{
    /* invert transparent PNG to white when hovering a black tile */
    filter:invert(1) brightness(2) saturate(0);
  }

  /* TITLE overlays at the bottom, clamped, without reducing icon area */
  .tile .t{
    position:absolute; left:var(--pad); right:var(--pad); bottom:var(--pad);
    text-align:center; line-height:1.1;
    display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
    pointer-events:none; /* text overlay shouldn't block clicks */
  }

  /* FEATURED — fixed, uniform white frame; image scales with inset */
  .featured{
    height:100%; overflow:auto; scrollbar-width:none;
    display:flex; flex-direction:column; align-items:center; gap:10px; padding-right:4px;
  }
  .featured::-webkit-scrollbar{ display:none; }

  .carousel{
    position:relative; width:100%; max-width:640px; height:var(--carousel-h);
    background:#fff; border:1px solid #000; display:none;
    overflow:hidden; /* enforce the fixed frame */
  }
  .carousel-inner{
    position:absolute; inset:0; padding:var(--img-inset) 0; /* top/bottom white inset */
    display:flex; align-items:center; justify-content:center;
    background:#fff; z-index:1;
  }
  .carousel-inner img{
    max-width:100%; max-height:100%;
    width:auto; height:auto;
    object-fit:contain; /* SCALE IMAGE FULLY INTO FRAME */
    background:#fff;
  }
  .nav-btn{
    position:absolute; top:50%; transform:translateY(-50%);
    width:28px; height:28px; background:#000; color:#fff; border:none;
    display:grid; place-items:center; cursor:pointer; transition:color .2s ease;
    z-index:3;
  }
  .nav-btn:hover{ color:var(--accent); }
  .nav-left{ left:6px; clip-path:polygon(100% 0, 0 50%, 100% 100%); }
  .nav-right{ right:6px; clip-path:polygon(0 0, 100% 50%, 0 100%); }

  .title{ width:100%; max-width:640px; text-align:left; }
  .desc{
    width:100%; max-width:640px; text-align:left;
    background:#fff; border:1px solid #000; padding:8px; box-sizing:border-box; display:none;
  }

  .buy-row{
    width:100%; max-width:640px; display:none; align-items:center; justify-content:space-between; gap:8px;
  }
  .price{ background:#fff; border:1px solid #000; padding:8px; }
  .qty{ display:flex; align-items:center; gap:8px; }
  .step{ width:28px; height:28px; background:#000; color:#fff; border:none; cursor:pointer; transition:color .2s ease; }
  .step:hover{ color:var(--accent); }
  .qty-val{ min-width:28px; text-align:center; }
  .add{ background:#000; color:#fff; border:1px solid #000; padding:8px 12px; cursor:pointer; transition:color .2s ease; }
  .add:hover{ color:var(--accent); }
  .total{ background:#fff; border:1px solid #000; padding:8px; min-width:120px; text-align:center; }

  /* Footer */
  .footer{
    position:fixed; left:0; right:0; bottom:0; height:var(--footer-h);
    border-top:1px solid #000; background:var(--bg);
  }
  .footer-wrap{
    position:absolute; left:12px; bottom:12px; display:flex; flex-direction:column; gap:10px;
    font-size:13px;
  }
  .footer a{ color:#000; }
  .footer a:hover{ color:#fff; }
  .footer a.mystery:hover{
    background:linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .credit{
    position:absolute; right:12px; bottom:8px; font-size:12px;
  }

  /* Truck popup (boxed) */
  .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:1000; }
  .cart{
    position:absolute; right:20px; top:calc(var(--header-h) + 12px);
    width:400px; max-height:70vh; overflow:auto;
    background:#fff; color:#000; border:1px solid #000; padding:12px; box-sizing:border-box;
  }
  .cart-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
  .close{ background:#000; color:#fff; border:none; padding:6px 10px; cursor:pointer; transition:color .2s ease; }
  .close:hover{ color:var(--accent); }

  /* Cart line: thumb | name | qty-ctrl | subtotal | remove */
  .line{
    display:grid; grid-template-columns:56px 1fr auto auto auto; align-items:center; gap:8px;
    padding:6px 0; border-bottom:1px solid #000;
  }
  .line img{
    width:56px; height:56px; object-fit:contain; background:#fff; border:1px solid #000;
  }
  .qtymini{
    display:flex; align-items:center; gap:6px;
    background:#fff; border:1px solid #000; padding:2px 4px;
  }
  .qbtn{
    width:22px; height:22px; background:#000; color:#fff; border:none; cursor:pointer; transition:color .2s ease;
  }
  .qbtn:hover{ color:var(--accent); }
  .qval{ min-width:18px; text-align:center; }
  .rm{
    background:#000; color:#fff; border:1px solid #000; padding:4px 6px; cursor:pointer; transition:color .2s ease;
  }
  .rm:hover{ color:var(--accent); }

  .grand{ margin-top:8px; display:flex; justify-content:space-between; border-top:1px solid #000; padding-top:8px; }
  .drive{
    margin-top:10px; width:100%; display:inline-block; text-align:center;
    background:#000; color:#fff; border:1px solid #000; padding:10px; cursor:pointer; transition:opacity .2s ease, color .2s ease;
  }
  .drive:hover{ color:var(--accent); }
  .drive.disabled{ opacity:.45; pointer-events:none; cursor:default; color:#fff; }
</style>
</head>
<body>

<!-- Cursor -->
<div id="custom-cursor" aria-hidden="true"></div>

<!-- Header -->
<header class="header">
  <div id="truckIcon" class="truck-icon" title="Open truck"></div>
</header>

<!-- Logo above sidebar -->
<div class="logo-above-sidebar">
  <img src="VT_logo.png" alt="VT Logo">
</div>

<!-- Sidebar -->
<nav class="sidebar">
  <a class="cat active" data-filter="all">ALL</a>
  <a class="cat" data-filter="lighting">LIGHTING</a>
  <a class="cat" data-filter="furniture">FURNITURE</a>
  <a class="cat" data-filter="structures">STRUCTURES</a>
  <a class="cat" data-filter="art">ART</a>
</nav>

<!-- Content -->
<section class="content">
  <!-- Grid -->
  <div class="left-col">
    <div class="grid" id="grid"></div>
  </div>

  <!-- Featured -->
  <div class="right-col">
    <div class="featured">
      <div class="carousel" id="carousel">
        <button class="nav-btn nav-left" id="prevBtn" title="Prev"></button>
        <div class="carousel-inner">
          <img id="carouselImg" alt="">
        </div>
        <button class="nav-btn nav-right" id="nextBtn" title="Next"></button>
      </div>

      <div class="title" id="featTitle"></div>
      <div class="desc" id="featDesc"></div>

      <div class="buy-row" id="buyRow">
        <div class="price" id="featPrice">$0.00</div>
        <div class="qty">
          <button class="step" id="decBtn">-</button>
          <div class="qty-val" id="qtyVal">1</div>
          <button class="step" id="incBtn">+</button>
        </div>
        <button class="add" id="addBtn">ADD TO TRUCK</button>
        <div class="total" id="totalVal">$0.00</div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="footer">
  <div class="footer-wrap">
    <a href="https://jackvanthyne.org/vt-design-build.html">HOME PAGE</a>
    <a href="mailto:info@vtdesignbuild.com?subject=HELLO&body=hey,%0D%0A%0D%0Abest,%0D%0A_____">CONTACT</a>
    <a class="mystery" href="https://jackvanthyne.org/secretproducts.html">MYSTERY SHOP</a>
  </div>
  <div class="credit">THIS WEBSITE WAS MADE BY <a href="https://jackvanthyne.org/index.html">JACK VAN THYNE</a></div>
</footer>

<!-- Truck popup -->
<div class="overlay" id="overlay" style="display:none;">
  <div class="cart" role="dialog" aria-modal="true">
    <div class="cart-header">
      <div>TRUCK</div>
      <button class="close" id="closeCart">CLOSE</button>
    </div>
    <div id="cartList"></div>
    <div class="grand">
      <div>TOTAL</div>
      <div id="grandTotal">$0.00</div>
    </div>
    <a id="driveLink" class="drive disabled" href="#">DRIVE AWAY</a>
  </div>
</div>

<script>
/* Cursor */
const cursor = document.getElementById('custom-cursor');
document.addEventListener('mousemove', e => {
  const s = parseInt(getComputedStyle(cursor).width);
  cursor.style.transform = `translate(${e.clientX - s/2}px, ${e.clientY - s/2}px)`;
}, { passive:true });

/* Products (icons are .png) */
const PRODUCTS = [
  { id:'product001', cat:'lighting',  title:'JAPANESE JOINT DESK LAMP', price:325,
    desc:'THIS WARM JAPANESE-INSPIRED DESK LAMP IS MADE WITH RECLAIMED OAK. IT IS DIMMABLE AND THE PRODUCT DIMENSIONS ARE H 16” W 6” L 6”. THIS PRODUCT IS UL CERTIFIED.',
    images:['product001_image001.jpg','product001_image002.jpg','product001_image003.jpg'], icon:'product001_icon.png' },
  { id:'product002', cat:'lighting',  title:'JAPANESE JOINT DESK LAMP', price:650,
    desc:'THIS WARM JAPANESE-INSPIRED FLOOR LAMP IS MADE WITH RECLAIMED OAK. IT IS DIMMABLE AND THE PRODUCT DIMENSIONS ARE H 48” W 12” L 12”. THIS PRODUCT IS UL CERTIFIED.',
    images:['product002_image001.jpg','product002_image002.jpg','product002_image003.jpg'], icon:'product002_icon.png' },

  { id:'product003', cat:'furniture', title:'OUTDOOR TABLE', price:1600,
    desc:'BUILT FROM LOCALLY SOURCED AND MILLED REDWOOD FOR NATURAL DURABILITY AND WEATHER RESISTANCE. SEATS 4–6 AND IS DESIGNED FOR PATIOS AND GARDENS.',
    images:['product003_image001.jpg','product003_image002.jpg','product003_image003.jpg'], icon:'product003_icon.png' },
  { id:'product004', cat:'furniture', title:'OUTDOOR BENCH', price:425,
    desc:'A MINIMALIST BENCH CRAFTED FROM LOCALLY SOURCED AND MILLED REDWOOD. COMFORTABLE, STURDY SEATING FOR PORCHES, ENTRIES, AND GARDEN PATHS.',
    images:['product004_image001.jpg','product004_image002.jpg','product004_image003.jpg'], icon:'product004_icon.png' },
  { id:'product005', cat:'furniture', title:'OUTDOOR LOUNGE CHAIR', price:1400,
    desc:'ERGONOMIC LOUNGE CHAIR MADE FROM LOCALLY SOURCED AND MILLED REDWOOD. RELAXED RECLINE FOR LONG, COMFORTABLE SITS.',
    images:['product005_image001.jpg','product005_image002.jpg','product005_image003.jpg'], icon:'product005_icon.png' },
  { id:'product006', cat:'furniture', title:'OUTDOOR LOVE SEAT', price:1600,
    desc:'TWO-SEATER LOVE SEAT IN LOCALLY SOURCED AND MILLED REDWOOD—COZY, DURABLE, AND READY FOR ALL-SEASON OUTDOOR LIVING.',
    images:['product006_image001.jpg','product006_image002.jpg','product006_image003.jpg'], icon:'product006_icon.png' },

  { id:'product007', cat:'structures', title:'MOBILE SAUNA', price:60000,
    desc:'A TRANSPORTABLE WOOD-FIRED SAUNA DESIGNED FOR QUICK SETUP AND OFF-GRID USE. INSULATED CONSTRUCTION, TEMPERED GLASS DOOR, AND INTERIOR BENCHING FOR 4–6.',
    images:['product007_image001.jpg','product007_image002.jpg','product007_image003.jpg'], icon:'product007_icon.png' },
  { id:'product008', cat:'structures', title:'FLOATING SAUNA', price:80000,
    desc:'A BARGE-MOUNTED, WOOD-FIRED SAUNA BUILT FOR LAKES OR CALM BAYS. MARINE-SAFE DETAILS, CHANGING NOOK, AND PANORAMIC WINDOW—SEATS 6–8.',
    images:['product008_image001.jpg','product008_image002.jpg','product008_image003.jpg'], icon:'product008_icon.png' },

  { id:'product009', cat:'art',       title:'REDWOODS', price:1200,
    desc:'ACRYLIC ON WOOD.',
    images:['product009_image001.jpg','product009_image002.jpg','product009_image003.jpg'], icon:'product009_icon.png' },
  { id:'product010', cat:'art',       title:'WOMAN DANCING', price:1300,
    desc:'ACRYLIC ON WOOD.',
    images:['product010_image001.jpg','product010_image002.jpg','product010_image003.jpg'], icon:'product010_icon.png' }
];

/* State */
let filter = 'all';
let locked = false;
let selected = null;
let hovered  = null;
let imgIdx   = 0;
let qty      = 1;

/* Elements */
const grid       = document.getElementById('grid');
const cats       = document.querySelectorAll('.cat');
const carousel   = document.getElementById('carousel');
const carouselImg= document.getElementById('carouselImg');
const prevBtn    = document.getElementById('prevBtn');
const nextBtn    = document.getElementById('nextBtn');
const featTitle  = document.getElementById('featTitle');
const featDesc   = document.getElementById('featDesc');
const featPrice  = document.getElementById('featPrice');
const buyRow     = document.getElementById('buyRow');
const qtyVal     = document.getElementById('qtyVal');
const decBtn     = document.getElementById('decBtn');
const incBtn     = document.getElementById('incBtn');
const addBtn     = document.getElementById('addBtn');
const totalVal   = document.getElementById('totalVal');

const truckIcon  = document.getElementById('truckIcon');
const overlay    = document.getElementById('overlay');
const closeCart  = document.getElementById('closeCart');
const cartList   = document.getElementById('cartList');
const grandTotal = document.getElementById('grandTotal');
const driveLink  = document.getElementById('driveLink');

/* Cart */
const CART = new Map();
const money = n => '$' + n.toFixed(2);

/* Grid */
function renderGrid(){
  grid.innerHTML = '';
  const items = PRODUCTS.filter(p => filter === 'all' ? true : p.cat === filter);
  items.forEach(p => {
    const tile = document.createElement('a');
    tile.href = 'javascript:void(0)';
    tile.className = 'tile';
    tile.dataset.id = p.id;

    const imgWrap = document.createElement('div');
    imgWrap.className = 'tile-img';
    const img = document.createElement('img');
    img.src = p.icon || (p.images[0] || '');
    img.alt = p.title;

    const title = document.createElement('div');
    title.className = 't';
    title.textContent = p.title;

    tile.appendChild(imgWrap);
    imgWrap.appendChild(img);
    tile.appendChild(title);

    // Hover only before first click
    tile.addEventListener('mouseenter', () => { if (!locked) preview(p); });
    // Click locks (clicking another replaces)
    tile.addEventListener('click', () => select(p));

    grid.appendChild(tile);
  });
}

/* Preview vs select */
function preview(p){ hovered = p; showFeatured(p); }
function select(p){ selected = p; locked = true; showFeatured(p); }

/* Featured panel */
function showFeatured(p){
  featTitle.textContent = p.title;
  featDesc.style.display = 'block';
  featDesc.textContent = p.desc || '';
  featPrice.textContent = money(p.price);
  qty = 1; qtyVal.textContent = '1';
  totalVal.textContent = money(p.price * qty);
  buyRow.style.display = 'flex';

  imgIdx = 0;
  if (p.images && p.images.length){
    carousel.style.display = 'block';
    carouselImg.src = p.images[0];
  } else {
    carousel.style.display = 'none';
    carouselImg.removeAttribute('src');
  }
}

/* Current product */
function currentProduct(){ return selected || (!locked ? hovered : null); }

/* Carousel */
prevBtn.addEventListener('click', () => {
  const p = currentProduct(); if (!p || !p.images?.length) return;
  imgIdx = (imgIdx - 1 + p.images.length) % p.images.length;
  carouselImg.src = p.images[imgIdx];
});
nextBtn.addEventListener('click', () => {
  const p = currentProduct(); if (!p || !p.images?.length) return;
  imgIdx = (imgIdx + 1) % p.images.length;
  carouselImg.src = p.images[imgIdx];
});

/* Qty & totals */
incBtn.addEventListener('click', () => {
  qty += 1; qtyVal.textContent = String(qty);
  const p = currentProduct(); if (!p) return;
  totalVal.textContent = money(p.price * qty);
});
decBtn.addEventListener('click', () => {
  qty = Math.max(1, qty - 1); qtyVal.textContent = String(qty);
  const p = currentProduct(); if (!p) return;
  totalVal.textContent = money(p.price * qty);
});

/* Add to truck (flash longer + tiny bounce) */
addBtn.addEventListener('click', () => {
  const p = currentProduct(); if (!p) return;
  if (CART.has(p.id)){
    const e = CART.get(p.id); e.qty += qty; CART.set(p.id, e);
  } else {
    CART.set(p.id, { id:p.id, title:p.title, price:p.price, qty:qty, thumb:(p.icon || p.images[0] || '') });
  }
  truckIcon.classList.add('flash','bounce');
  setTimeout(() => truckIcon.classList.remove('flash'),
    parseInt(getComputedStyle(document.documentElement).getPropertyValue('--flash-ms')) || 800);
  setTimeout(() => truckIcon.classList.remove('bounce'),
    parseInt(getComputedStyle(document.documentElement).getPropertyValue('--bounce-ms')) || 400);
});

/* Sidebar filters */
cats.forEach(c => {
  c.addEventListener('click', () => {
    cats.forEach(x => x.classList.remove('active'));
    c.classList.add('active');
    filter = c.dataset.filter;
    renderGrid();
    if (!selected){
      featTitle.textContent = '';
      featDesc.style.display = 'none';
      buyRow.style.display = 'none';
      carousel.style.display = 'none';
    }
  });
});

/* Build mailto from cart */
function buildMailto(total){
  let lines = [];
  CART.forEach(({title, price, qty}) => {
    const sub = price * qty;
    lines.push(`${title} — QTY ${qty} — ${money(sub)}`);
  });
  lines.push('');
  lines.push(`SUBTOTAL — ${money(total)}`);
  lines.push('');
  lines.push('Best,');
  lines.push('_____');
  const subject = encodeURIComponent('VT DESIGN BUILD — CART CHECKOUT');
  const body = encodeURIComponent(lines.join('\r\n'));
  return `mailto:info@vtdesignbuild.com?subject=${subject}&body=${body}`;
}

/* Cart popup */
function renderCart(){
  cartList.innerHTML = '';
  let total = 0;
  CART.forEach(({id, title, price, qty, thumb}) => {
    const line = document.createElement('div');
    line.className = 'line';
    line.dataset.id = id;

    const img = document.createElement('img');
    img.src = thumb || '';
    img.alt = title;

    const name = document.createElement('div');
    name.textContent = title;

    const qtyMini = document.createElement('div');
    qtyMini.className = 'qtymini';
    qtyMini.innerHTML = `
      <button class="qbtn" data-act="dec">-</button>
      <div class="qval">${qty}</div>
      <button class="qbtn" data-act="inc">+</button>
    `;

    const sub = document.createElement('div');
    sub.className = 'subtotal';
    sub.textContent = money(price * qty);

    const rm = document.createElement('button');
    rm.className = 'rm'; rm.textContent = 'REMOVE'; rm.dataset.act = 'rm';

    line.appendChild(img);
    line.appendChild(name);
    line.appendChild(qtyMini);
    line.appendChild(sub);
    line.appendChild(rm);

    cartList.appendChild(line);
    total += price * qty;
  });
  grandTotal.textContent = money(total);

  // Enable/disable DRIVE AWAY depending on cart content
  if (CART.size === 0){
    driveLink.classList.add('disabled');
    driveLink.href = '#';
  } else {
    driveLink.classList.remove('disabled');
    driveLink.href = buildMailto(total);
  }
}

/* Qty/Remove within cart (event delegation) */
cartList.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;
  const line = e.target.closest('.line');
  if (!line) return;
  const id = line.dataset.id;
  if (!CART.has(id)) return;

  const entry = CART.get(id);
  const act = btn.dataset.act;
  if (act === 'inc') entry.qty += 1;
  if (act === 'dec') entry.qty = Math.max(1, entry.qty - 1);
  if (act === 'rm')  CART.delete(id); else CART.set(id, entry);
  renderCart();
});

/* Open/close truck */
truckIcon.addEventListener('click', () => {
  renderCart();
  overlay.style.display = 'block';
});
document.getElementById('closeCart').addEventListener('click', () => {
  overlay.style.display = 'none';
});
overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.style.display = 'none'; });

/* Prevent clicking disabled drive link */
driveLink.addEventListener('click', (e) => {
  if (e.currentTarget.classList.contains('disabled')) e.preventDefault();
});

/* Init */
renderGrid();
</script>
</body>
</html>
