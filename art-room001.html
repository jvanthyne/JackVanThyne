<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>&lt; &gt; room 001</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background: #000;
  }

  * { cursor: none !important; }

  #custom-cursor {
    position: fixed;
    top: 0;
    left: 0;
    width: 32px;
    height: 32px;
    pointer-events: none;
    z-index: 9999;
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    background: #fff;
    mix-blend-mode: difference;
    transform: translate(-100px, -100px);
  }

  #background-container {
    position: absolute;
    top: 0;
    left: 0;
    height: 100vh;
    width: 200vw; /* double wide */
    display: flex;
    z-index: 1;
  }

  #background-container img {
    height: 100%;
    width: 100%; /* stretches to 200vw */
    object-fit: cover;
  }

  #doorImg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
    z-index: 2;
    transition: filter 0.18s ease;
  }

  #doorImg.hovering { filter: invert(1); }

  #flash {
    position: fixed;
    inset: 0;
    background: #000;
    opacity: 0;
    pointer-events: none;
    z-index: 999;
    transition: opacity 0.25s ease;
  }
</style>
</head>
<body>
  <div id="background-container">
    <img src="art_room001_background.png" alt="Background">
  </div>

  <img src="art_room001_door.png" id="doorImg" alt="Door">
  <div id="flash"></div>
  <div id="custom-cursor"></div>

  <script>
    // ---------------- Cursor ----------------
    const cursor = document.getElementById('custom-cursor');
    document.addEventListener('mousemove', e => {
      cursor.style.transform = `translate(${e.clientX - 16}px, ${e.clientY - 16}px)`;
    });

    // ---------------- Scrollable background ----------------
    const container = document.getElementById('background-container');
    let scrollX = 0;
    const maxScroll = window.innerWidth; 
    document.addEventListener('keydown', e => {
      if(e.key === 'ArrowRight') scrollX = Math.min(scrollX + 50, maxScroll);
      if(e.key === 'ArrowLeft') scrollX = Math.max(scrollX - 50, 0);
      container.style.transform = `translateX(-${scrollX}px)`;
    });

    // ---------------- Door hover ----------------
    const doorImg = document.getElementById('doorImg');
    const doorCanvas = document.createElement('canvas');
    const doorCtx = doorCanvas.getContext('2d', { willReadFrequently: true });
    let doorReady = false;

    function prepareDoorHitmap() {
      const w = doorImg.naturalWidth || doorImg.width;
      const h = doorImg.naturalHeight || doorImg.height;
      if (!w || !h) return;
      doorCanvas.width = w; doorCanvas.height = h;
      const bmp = new Image();
      bmp.crossOrigin = doorImg.crossOrigin || '';
      bmp.src = doorImg.currentSrc || doorImg.src;
      bmp.onload = () => { doorCtx.drawImage(bmp, 0, 0); doorReady = true; };
      if (bmp.complete && bmp.naturalWidth) { doorCtx.drawImage(bmp, 0, 0); doorReady = true; }
    }
    if (doorImg.complete && doorImg.naturalWidth) prepareDoorHitmap();
    else doorImg.addEventListener('load', prepareDoorHitmap, { once: true });

    function testDoorHover(clientX, clientY) {
      if (!doorReady) { doorImg.classList.remove('hovering'); return; }
      const rect = doorImg.getBoundingClientRect();
      if (clientX < rect.left || clientX > rect.right || clientY < rect.top || clientY > rect.bottom) {
        doorImg.classList.remove('hovering'); return;
      }
      const xNorm = (clientX - rect.left) / rect.width;
      const yNorm = (clientY - rect.top) / rect.height;
      const px = Math.floor(xNorm * doorCanvas.width);
      const py = Math.floor(yNorm * doorCanvas.height);
      const alpha = doorCtx.getImageData(px, py, 1, 1).data[3];
      if(alpha > 1) doorImg.classList.add('hovering'); else doorImg.classList.remove('hovering');
    }

    document.addEventListener('mousemove', e => testDoorHover(e.clientX, e.clientY));
    document.addEventListener('touchmove', e => {
      const t = e.touches[0]; if(!t) return;
      testDoorHover(t.clientX, t.clientY);
    });

    function tryEnter(clientX, clientY){
      if(!doorReady) return;
      const rect = doorImg.getBoundingClientRect();
      const inside = clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;
      if(inside && doorImg.classList.contains('hovering')){
        document.getElementById('flash').style.opacity = 1;
        setTimeout(()=>{ window.location.href = 'next-room.html'; }, 250);
      }
    }
    document.addEventListener('click', e => tryEnter(e.clientX, e.clientY));
    document.addEventListener('touchend', e => { const t = e.changedTouches[0]; if(t) tryEnter(t.clientX, t.clientY); });
  </script>
</body>
</html>
